<!DOCTYPE html>
<html>
<head>
  <title>Graph</title>
  <!-- Include the Chart.js library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- <canvas id="Chart4" style="width: 100%; height: 420px"></canvas> -->
  <canvas id="salesTargetsChart" width="400" height="200"></canvas>
  <script>
    // Fetch the JSON data from Django template variables
    var reportData = JSON.parse('{{ report_data|escapejs }}');
    var targetData = JSON.parse('{{ target_data|escapejs }}');
    console.log(targetData);
    console.log(reportData);
  
    // Function to calculate the total sales and total targets for each month
    function calculateTotalsByMonth(data) {
      const totalsByMonth = {};
      data.forEach((item) => {
        const { total_sales, total_targets, sales_month } = item;
        if (totalsByMonth[sales_month]) {
          totalsByMonth[sales_month].total_sales += parseFloat(total_sales);
          totalsByMonth[sales_month].total_targets += parseFloat(total_targets);
        } else {
          totalsByMonth[sales_month] = {
            total_sales: parseFloat(total_sales),
            total_targets: parseFloat(total_targets),
          };
        }
      });
      return totalsByMonth;
    }
  
    // Process the JSON data to get total sales and total targets by month
    const salesTotalsByMonth = calculateTotalsByMonth(reportData);
    const targetsTotalsByMonth = calculateTotalsByMonth(targetData);
  
    // Prepare data for the chart
    const months2 = Object.keys(salesTotalsByMonth);
    const months = Object.keys(targetsTotalsByMonth);
    const salesData = months2.map((month) => salesTotalsByMonth[month].total_sales);
    const targetsData = months.map((month) => targetsTotalsByMonth[month].total_targets);
  
    // Create the chart
    const ctx = document.getElementById("salesTargetsChart").getContext("2d");
    const chart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: months,
        datasets: [
          {
            label: "Total Sales",
            backgroundColor: "#4A6CF7",
            data: salesData,
          },
          {
            label: "Total Targets",
            backgroundColor: "#d50100",
            data: targetsData,
          },
        ],
      },
      options: {
        // Add any additional options here if needed
        // For example, you can customize tooltips, axis labels, etc.
        
      },
    });
  </script>
</body>
</html>
